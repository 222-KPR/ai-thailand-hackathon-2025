# Frontend Development Dockerfile for AI4Thai Crop Guardian
# Optimized for Yew WebAssembly development with hot reload

FROM rust:1.75-slim as base

# Install system dependencies
RUN apt-get update && apt-get install -y \
    pkg-config \
    libssl-dev \
    curl \
    wget \
    gnupg \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*

# Install Node.js for frontend tooling
RUN curl -fsSL https://deb.nodesource.com/setup_18.x | bash - \
    && apt-get install -y nodejs

# Install WebAssembly target
RUN rustup target add wasm32-unknown-unknown

# Install Trunk (WebAssembly build tool)
RUN cargo install trunk wasm-pack

# Install additional Rust tools for development
RUN cargo install cargo-watch

# Install Node.js development tools
RUN npm install -g serve lighthouse

# Set working directory
WORKDIR /app

# Copy package files first for better caching
COPY Cargo.toml Cargo.lock ./
COPY Trunk.toml ./

# Copy source code
COPY src/ ./src/
COPY static/ ./static/
COPY styles/ ./styles/
COPY index.html ./

# Expose development server port
EXPOSE 8080

# Development command with hot reload
CMD ["trunk", "serve", "--address", "0.0.0.0", "--port", "8080", "--open"]
